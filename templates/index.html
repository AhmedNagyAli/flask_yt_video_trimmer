<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <title>YT Video Trimmer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes blink {
      0%, 100% { border-color: transparent }
      50% { border-color: black }
    }
    .typewriter {
      border-right: 2px solid black;
      white-space: nowrap;
      overflow: hidden;
      animation: blink 0.75s step-end infinite;
    }
  </style>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen px-4 py-8">

  <!-- Arabic-only description above the form -->
  <div class="max-w-xl w-full mb-8 text-center space-y-6" dir="rtl">
    <p id="introAR" class="text-gray-900 font-semibold text-base h-6"></p>
  </div>

  <!-- Modal -->
  <div id="loadingModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-50 px-4">
    <div class="bg-white px-6 py-6 sm:px-10 sm:py-8 rounded-2xl flex flex-col items-center space-y-4 sm:space-y-6 w-full max-w-sm sm:max-w-md shadow-2xl">
      <svg class="w-12 h-12 sm:w-16 sm:h-16 text-indigo-600 animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      <p id="typewriterText" class="text-lg sm:text-xl font-semibold text-gray-800 typewriter w-full text-center h-8 sm:h-10"></p>
    </div>
  </div>

  <!-- Form Container -->
  <div class="bg-white p-4 sm:p-6 rounded shadow-md w-full max-w-sm sm:max-w-md z-10">
    <h1 class="text-lg sm:text-xl font-bold mb-4 text-center">🎥 YT Video Trimmer</h1>

    {% if error %}
      <div class="mb-4 text-red-600 bg-red-100 border border-red-400 p-2 rounded text-sm text-center">
        {{ error }}
      </div>
    {% endif %}

    <form method="POST" id="downloadForm" class="space-y-4">
      <input
        type="text"
        name="youtube_url"
        placeholder="Enter YouTube URL"
        class="w-full p-2 border border-gray-300 rounded"
        required
      />
      <button
        type="submit"
        id="submitBtn"
        class="w-full bg-indigo-700 text-white p-2 rounded hover:bg-blue-600 flex justify-center items-center"
      >
        <span id="buttonText">Get Resolutions</span>
        <svg
          id="spinner"
          class="hidden w-5 h-5 ml-2 text-white animate-spin"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
        >
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path
            class="opacity-75"
            fill="currentColor"
            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
          ></path>
        </svg>
      </button>
    </form>
  </div>

  <!-- Bilingual text section below the form -->
  <div class="max-w-xl w-full mt-4 text-center space-y-1">
    <p id="lineEN" class="text-orange-700 font-semibold text-base h-6"></p>
    <p id="lineAR" class="text-orange-700 font-semibold text-base h-6" dir="rtl"></p>
  </div>

  <script>
    // Arabic intro text (above form)
    const introLines = [
      "اداة بسيطة تمكنك من قص اي جزء تريد من اي فديو يوتيوب دون الحاجه لتنزيل المقطع كامل وقصه",
      "فقط يمكنك وضع رابط المقطع وسيتم تحميل الجودات المتاحة لهذا المقطع",
      "قم باختاير الجودة التي تريد وحدد الجزء الذي تريد قصه وسيتم في لحظات تحويلك لصفحة التحميل"
    ];
    const introElem = document.getElementById('introAR');

    async function loopIntroText() {
      let i = 0;
      while (true) {
        await typeWriterLoop(introElem, introLines[i % introLines.length], 50);
        i++;
      }
    }

    // Bilingual text below the form
    const linesEN = [
      "Since it is a free hosting,",
      "it only works on small videos and still has problems,",
      "and may crash many times till you can get your video... ",
      "sorry for that and we hope you wait for the final version."
    ];

    const linesAR = [
      "نظرًا لأنها استضافة مجانية،",
      "فإنه يعمل فقط على مقاطع الفيديو الصغيرة ولا يزال به بعض المشاكل",
      "وقد يتعطل عدة مرات حتى تتمكن من الحصول على الفيديو الخاص بك...",
      "نأسف لذلك ونأمل أن تنتظر الإصدار النهائي."
    ];

    const elemEN = document.getElementById('lineEN');
    const elemAR = document.getElementById('lineAR');

    async function loopBilingualText() {
      let i = 0;
      while (true) {
        await Promise.all([
          typeWriterLoop(elemEN, linesEN[i % linesEN.length]),
          typeWriterLoop(elemAR, linesAR[i % linesAR.length])
        ]);
        i++;
      }
    }

    // Generic typewriter loop function
    function typeWriterLoop(element, text, speed = 60) {
      return new Promise(async (resolve) => {
        for (let i = 0; i <= text.length; i++) {
          element.textContent = text.substring(0, i);
          await new Promise(r => setTimeout(r, speed));
        }
        await new Promise(r => setTimeout(r, 1000));
        for (let i = text.length; i >= 0; i--) {
          element.textContent = text.substring(0, i);
          await new Promise(r => setTimeout(r, speed));
        }
        await new Promise(r => setTimeout(r, 500));
        resolve();
      });
    }

    // Modal typewriter functionality
    const form = document.getElementById('downloadForm');
    const modal = document.getElementById('loadingModal');
    const typewriter = document.getElementById('typewriterText');
    const modalMessage = "Processing the video resolutions...";
    let index = 0;
    let isDeleting = false;

    function loopTypewriterModal() {
      let currentText = typewriter.textContent;

      if (!isDeleting) {
        typewriter.textContent = modalMessage.substring(0, index + 1);
        index++;
        if (index === modalMessage.length) {
          isDeleting = true;
          setTimeout(loopTypewriterModal, 500);
          return;
        }
      } else {
        typewriter.textContent = modalMessage.substring(0, index - 1);
        index--;
        if (index === 0) {
          isDeleting = false;
        }
      }

      setTimeout(loopTypewriterModal, 60);
    }

    // Trigger modal on form submit
    form.addEventListener('submit', function () {
      document.getElementById('submitBtn').disabled = true;
      document.getElementById('buttonText').textContent = 'Processing...';
      document.getElementById('spinner').classList.remove('hidden');
      modal.classList.remove('hidden');
      loopTypewriterModal();
    });

    // Start everything on page load
    window.addEventListener('load', () => {
      loopIntroText();
      loopBilingualText();
    });
  </script>
</body>
</html>
